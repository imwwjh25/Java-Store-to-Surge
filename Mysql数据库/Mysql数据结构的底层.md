MySQL 底层存储数据时，会根据数据类型的特性（如长度、精度、是否可变）采用不同的存储格式，核心遵循 **“紧凑存储”** 和 **“对齐优化”** 原则。下面我会按类型分类，用通俗易懂的方式讲解核心数据类型的底层存储逻辑：

### 一、数值类型（最基础、最规整）

数值类型的存储是**固定字节数**（除 DECIMAL 外），直接以二进制形式存储，无额外开销。




|     类型     | 存储字节 |                         底层存储逻辑                         |
| :----------: | :------: | :----------------------------------------------------------: |
|   TINYINT    |    1     | 8 位二进制，有符号范围 `-128~127`（最高位为符号位），无符号 `0~255` |
|   SMALLINT   |    2     |     16 位二进制，有符号 `-32768~32767`，无符号 `0~65535`     |
| INT/INTEGER  |    4     |    32 位二进制，有符号 `-2^31~2^31-1`，无符号 `0~2^32-1`     |
|    BIGINT    |    8     |    64 位二进制，有符号 `-2^63~2^63-1`，无符号 `0~2^64-1`     |
|    FLOAT     |    4     | 遵循 IEEE 754 单精度浮点标准：1 位符号位 + 8 位指数位 + 23 位尾数位 |
|    DOUBLE    |    8     | 遵循 IEEE 754 双精度浮点标准：1 位符号位 + 11 位指数位 + 52 位尾数位 |
| DECIMAL(M,D) |   变长   | 以字符串形式存储（避免浮点精度丢失），每 2 位数字占 1 字节，符号 / 小数点额外占 1 字节 |

**示例**：

- 存储整数 `100`：INT 类型会将 `100` 转换为二进制 `00000000 00000000 00000000 01100100`，直接占用 4 字节。
- 存储 `DECIMAL(5,2)` 类型的 `123.45`：底层存为字符串 `12345`，占用 3 字节（12、34、5 各占部分，实际按数字位数计算），同时记录小数点位置。

### 二、字符串类型（分固定 / 可变长度）

字符串类型的存储分 **固定长度（CHAR）** 和 **可变长度（VARCHAR/TEXT/BLOB）**，核心区别是是否需要存储 “长度标识”。

#### 1. CHAR (M)：固定长度字符串

- 存储规则：无论实际存储多少字符，都占用 `M` 个字符对应的字节数（取决于字符集：UTF8MB4 每个字符占 1-4 字节，GBK 占 2 字节）。

- 底层逻辑：

    1. 存入数据时，若字符数不足 `M`，会用**空格**填充到 `M` 长度；
    2. 查询时，自动去掉末尾填充的空格；
    3. 无额外长度标识，直接存储字符的二进制编码。



- 示例：`CHAR(5)` 存储 `'abc'`（UTF8MB4），底层占 5 字节（`abc` + 2 个空格）。

#### 2. VARCHAR (M)：可变长度字符串

- 存储规则：仅占用实际字符数 + 1-2 字节的 “长度标识”（M≤255 时占 1 字节，M>255 时占 2 字节）。

- 底层逻辑：

    1. 先存储 1-2 字节的 “长度值”（记录实际字符的字节数）；
    2. 再存储字符的二进制编码（无填充，节省空间）；
    3. 最大长度受行大小限制（InnoDB 单行最大 65535 字节）。



- 示例：`VARCHAR(10)` 存储 `'abc'`（UTF8MB4），底层占 `1（长度标识） + 3（abc的字节）= 4` 字节。

#### 3. TEXT/BLOB：大字符串 / 二进制

- 存储规则：属于 “溢出存储”，默认情况下，前 768 字节存在行内，超出部分存到 “溢出页”，行内仅存指向溢出页的指针。

- 底层逻辑：

    - TEXT 存储字符（有字符集），BLOB 存储二进制（无字符集）；
    - 无需指定长度（MySQL 自动管理），但分不同级别：TINYTEXT (255)、TEXT (65535)、MEDIUMTEXT (16M)、LONGTEXT (4G)。



### 三、日期时间类型（重点：编码存储，非字符串）

你之前问过 DATETIME 和 TIMESTAMP，它们的底层存储并非直接存字符串，而是用 “压缩编码”：






|   类型    | 存储字节 |                         底层存储逻辑                         |
| :-------: | :------: | :----------------------------------------------------------: |
|   DATE    |    3     | 按 `年+月+日` 编码：年（7 位）+ 月（4 位）+ 日（5 位），共 16 位（2 字节）？实际 MySQL 优化为 3 字节：年（1 字节偏移，从 1000 开始）+ 月（1 字节）+ 日（1 字节） |
|   TIME    |    3     | 存储 “小时 + 分钟 + 秒” 的编码值，支持负数（如 `-12:30:00`），用 bit 位标识符号和时间分量 |
| DATETIME  |    8     | 分两部分存储：前 4 字节存 “年 - 月 - 日”（类似 DATE 的扩展），后 4 字节存 “时：分: 秒”（精确到秒），无时区转换 |
| TIMESTAMP |    4     | 存储从 `1970-01-01 00:00:00 UTC` 开始的**秒数**（32 位整数），查询时转换为会话时区 |
|   YEAR    |    1     | 1 字节存储，范围 `1901~2155`，直接存年份的偏移值（如 1900 为基准，1999 存 99） |

**关键示例**：

- ```TIMESTAMP```存储``` 2026-02-25 10:00:00```（东 8 区）：

    1. 先转换为 UTC 时间：`2026-02-25 02:00:00`；
    2. 计算距离 1970-01-01 00:00:00 的秒数（约 1772004000）；
    3. 将这个秒数以 32 位二进制形式存入 4 字节空间。



### 四、特殊类型（ENUM/SET）

这类类型是 “枚举 / 集合”，底层用**整数映射**存储，非常节省空间：

1. ENUM（枚举）：

    - 底层存储整数（1、2、3...），每个整数对应枚举值列表中的一个选项；
    - 若枚举值数量 ≤255，占 1 字节；>255 占 2 字节。
    - 示例：`ENUM('男','女')`，存储 `'男'` 实际存整数 1，`'女'` 存整数 2。



2. SET（集合）：

    - 底层用 “位掩码” 存储（1 位对应一个选项），最多 64 个选项；
    - 占 1-8 字节（根据选项数量），示例：`SET('A','B','C')`，存储 `'A,C'` 对应二进制 `101`（整数 5）。



### 总结

1. **数值类型**：固定字节 + 二进制存储，DECIMAL 例外（字符串存储），效率最高；
2. **字符串类型**：CHAR 固定长度（空格填充），VARCHAR 可变长度（带长度标识），TEXT/BLOB 溢出存储；
3. **日期时间类型**：DATETIME 8 字节（日期 + 时间），TIMESTAMP 4 字节（UTC 秒数），均为编码存储而非字符串；
4. **ENUM/SET**：整数 / 位掩码映射存储，比字符串更节省空间。

理解底层存储能帮你优化表设计：比如短字符串用 CHAR（无长度标识开销），长文本用 TEXT，跨时区时间用 TIMESTAMP，高精度数值用 DECIMAL 而非 FLOAT。