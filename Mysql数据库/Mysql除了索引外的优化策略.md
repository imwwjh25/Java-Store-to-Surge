###  MySQL 优化（除索引外）

#### 1. 架构层面

- 读写分离：主库写、从库读，分摊压力；
- 分库分表：水平分表（按用户 ID 哈希）、垂直分表（拆分大表为小表）；
- 缓存：热点数据缓存到 Redis，减少 DB 查询；
- 集群部署：避免单点故障，提升吞吐量。

#### 2. SQL 层面

- 避免 SELECT *：只查需要的字段，减少 IO / 内存占用；
- 避免子查询：改用 JOIN（子查询效率低，易产生临时表）；
- 避免 OR：用 IN 替代（OR 会导致索引失效）；
- 批量操作：批量插入（INSERT INTO ... VALUES (),(),()）、批量更新，减少网络交互；
- 限制结果集：分页查询（LIMIT），避免全表扫描。

#### 3. 数据库配置层面

- 调整连接池：设置合理的 max_connections（避免连接数耗尽）；
- 优化缓存：调整 innodb_buffer_pool_size（建议设为物理内存的 50%-70%）；
- 调整 IO 参数：innodb_flush_log_at_trx_commit（1 = 强一致性，0/2 = 高性能）；
- 关闭不必要的日志：如通用查询日志、慢查询日志（非调试时）。

#### 4. 存储层面

- 选择合适引擎：InnoDB（事务 / 行锁）、MyISAM（只读 / 高并发）；
- 优化数据类型：用 INT 替代 VARCHAR（主键）、用 DATETIME 替代 TIMESTAMP（避免时区问题）；
- 分区表：按时间 / 范围分区，减少扫描数据量。

#### 5. 其他

- 定期清理无用数据：归档历史数据，减少表大小；
- 优化锁机制：避免长事务（减少锁等待）、用行锁替代表锁；
- 慢查询优化：开启慢查询日志，分析并优化慢 SQL。