## 二、Maven 依赖仲裁策略（3 步核心规则，优先级从高到低）



Maven 解决依赖冲突的仲裁逻辑是 **“短路规则”**：按顺序判断，满足前一条规则就停止，不进入下一条。

### 第 1 步：路径最短优先（核心规则）



依赖路径是指 “项目 → 直接依赖 → 间接依赖” 的层级数，**路径越短，优先级越高**。

#### 例子：



- 场景 1：项目直接声明依赖```C-2.0.0```，同时通过```a.jar```间接依赖```C-1.0.0```

  - 路径对比：项目 → C-2.0.0（路径长度 1） vs 项目 → a.jar → C-1.0.0（路径长度 2）
  - 结果：选 C-2.0.0（路径更短）。

- 场景 2：项目不直接声明 C，仅通过```a.jar ```（路径 2）和```b.jar```（路径 2）间接依赖 C-1.0.0 和 C-2.0.0

  - 路径对比：两者路径长度相同（都是 2），进入第 2 步。

### 第 2 步：声明顺序优先（路径相同时生效）



当两个冲突依赖的路径长度一致时，**谁在 pom.xml 中声明得更靠前，谁的依赖版本就被选中**。

#### 例子：



项目 pom.xml 中依赖声明顺序：


```
<!-- 声明在前 -->
<dependency>
    <groupId>xxx</groupId>
    <artifactId>a</artifactId> <!-- 依赖 C-1.0.0 -->
</dependency>
<!-- 声明在后 -->
<dependency>
    <groupId>xxx</groupId>
    <artifactId>b</artifactId> <!-- 依赖 C-2.0.0 -->
</dependency>
```



- 结果：选 C-1.0.0（因为 a.jar 声明在前，其依赖的 C 版本优先级更高）。

### 第 3 步：版本号高低优先（Maven 3+ 新增，前两步都无法区分时生效）



如果路径长度相同、声明顺序也无法区分（比如通过不同依赖链引入，且声明顺序无先后差异），则 **优先选择版本号更高的依赖**。

#### 例子：



- 项目通过 `a.jar`（路径 2）依赖 C-1.0.0，通过 `b.jar`（路径 2）依赖 C-2.0.0，且 a 和 b 在 pom 中声明顺序无明确优先级（比如通过父 pom 引入）。
- 结果：选 C-2.0.0（版本号更高）。

⚠️ 注意：Maven 2 中没有这一步，仅按 “路径最短 + 声明顺序”，即使版本更低也会选中；Maven 3 新增版本号高低规则，更符合直觉。

## 三、为什么不是 “同时引入两个版本”？



Java 类加载机制是 **“全类名唯一”**（同一个类加载器下，`com.xxx.C` 只能有一个版本被加载）。如果 Maven 同时引入 C-1.0.0 和 C-2.0.0，会导致类冲突（`ClassNotFoundException` 或 `NoSuchMethodError`，比如 2.0.0 新增的方法在 1.0.0 中不存在，但代码调用了该方法）。

因此，Maven 的核心设计是 **“冲突时二选一”**，通过仲裁策略保证只引入一个版本，避免类加载混乱。

## 四、实战验证：如何查看最终依赖的版本？



如果想确认项目最终依赖的 C 版本，可以通过 Maven 命令查看依赖树：

```
# 查看完整依赖树（找到 C 的版本）
mvn dependency:tree

# 过滤指定依赖（只看 C 的依赖链）
mvn dependency:tree -Dincludes=groupId:artifactId（C 的 groupId 和 artifactId）
```



输出结果中会显示 C 的最终版本，以及它是通过哪个依赖链引入的（比如 `a.jar` 或 `b.jar`）。

## 五、总结



1. 核心结论：同时依赖 a 和 b 时，C 的版本由 Maven 仲裁策略决定，不是固定选高版本。
2. 仲裁 3 步（优先级：1 > 2 > 3）：
   - 路径最短优先；
   - 路径相同时，声明顺序优先；
   - 前两步无法区分时，版本号更高优先（Maven 3+）。
3. 本质原因：Java 类加载的 “全类名唯一性”，必须二选一避免类冲突。

实战中，如果想强制使用某个版本（比如必须用 C-2.0.0，避免 a.jar 引入的 1.0.0 存在 Bug），可以在 pom.xml 中 **直接声明 C 的依赖**（路径长度 1，优先级最高），覆盖间接依赖的版本：

```
<!-- 强制使用 C-2.0.0，无论 a 和 b 依赖哪个版本 -->
<dependency>
    <groupId>xxx</groupId>
    <artifactId>c</artifactId>
    <version>2.0.0</version>
</dependency>
```
