在 Git 中，当你在当前分支有未提交的代码（工作区或暂存区的修改），直接切换分支（`git checkout` 或 `git switch`）可能会失败（除非修改在目标分支中无冲突，Git 会允许携带修改切换，但不推荐）。此时，若不想提交代码又想切换分支，最常用的方式是通过 **`git stash`（暂存工作区修改）** 实现。

### 核心思路

`git stash` 可以将当前工作区和暂存区的修改 “暂存” 到一个临时区域（stash 栈），让工作区恢复到 “干净状态”（与最近一次提交一致），此时就能自由切换分支。后续回到原分支后，再从 stash 中恢复修改即可。

### 具体步骤

#### 1. 暂存当前修改（`git stash`）

执行以下命令，将未提交的修改（包括工作区和暂存区）暂存起来：





```bash
git stash
```

- 执行后，工作区会变得 “干净”（`git status` 会显示无修改）。

- 若有

  未跟踪的新文件

  （即没执行过



  ```
  git add
  ```



的文件），默认不会被 stash 暂存，需加上



  ```
  -u
  ```



参数：








  ```bash
  git stash -u  # 暂存包括未跟踪文件的所有修改
  ```



- 可以给 stash 加备注，方便后续识别：







  ```bash
  git stash save "暂存订单模块的修改"  # 备注信息
  ```



#### 2. 切换分支

此时工作区已干净，可正常切换到目标分支：









```bash
# 切换到分支 dev
git checkout dev
# 或使用 git switch（Git 2.23+ 支持）
git switch dev
```

#### 3. 完成操作后，切回原分支并恢复修改

当你在目标分支完成操作后，切回原分支，再从 stash 中恢复之前的修改：








```bash
# 切回原分支（例如 main）
git checkout main

# 恢复最近一次 stash 的修改（并删除该 stash）
git stash pop

# 或：恢复最近一次 stash 的修改（但保留该 stash，后续可再次恢复）
git stash apply
```

### 补充：管理 stash 栈

如果暂存了多次修改，可通过以下命令管理：

- 查看所有 stash 记录：







  ```bash
  git stash list
  # 输出示例：stash@{0}: On main: 暂存订单模块的修改
  #          stash@{1}: On main: 暂存支付模块的修改
  ```



- 恢复指定的 stash（例如恢复 stash@{1}）：
```bash
  git stash pop stash@{1}  # 恢复后删除该 stash
  # 或
  git stash apply stash@{1}  # 恢复后保留该 stash
  ```



- 删除指定的 stash：```bash git stash drop stash@{1}```



- 清空所有 stash：```bash git stash clear```



### 注意事项

1. **冲突风险**：若恢复 stash 时，当前分支的代码与 stash 中的修改有冲突（例如你在切换分支期间修改了同一文件），Git 会提示冲突，需手动解决后再提交。
2. **未跟踪文件**：默认 `git stash` 不包含未跟踪文件，若需暂存，务必加 `-u` 参数（`git stash -u`）。
3. **本地性**：stash 是本地存储，不会同步到远程仓库，换设备后无法获取，需及时恢复或提交。

### 特殊场景：允许修改携带到目标分支（不推荐）

如果你的未提交修改在目标分支中**没有冲突**（例如目标分支不存在这些文件的修改），Git 允许直接切换分支，修改会被 “携带” 到目标分支。但这种方式有风险（可能误将修改提交到错误分支），仅临时操作时慎用：







```bash
# 若修改与目标分支无冲突，可直接切换（修改会被带到目标分支）
git checkout dev
```

综上，**`git stash` 是最安全、最推荐的方式**，通过暂存 - 切换 - 恢复的流程，既能保证分支切换，又不会丢失未提交的代码。
