### 一、MySQL 索引下推（Index Condition Pushdown, ICP）

索引下推是 MySQL 5.6 及以上版本引入的优化机制，用于在使用二级索引（非主键索引）查询时，将部分过滤条件下推到存储引擎层处理，减少回表（访问主键索引获取完整数据）的次数，提升查询效率。

#### 示例场景

假设有一张`student`表，结构及数据如下：









```sql
CREATE TABLE student (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(50),
  age INT,
  class_id INT,
  INDEX idx_class_age (class_id, age) -- 联合索引：class_id在前，age在后
);

INSERT INTO student (name, age, class_id) VALUES
('张三', 18, 1),
('李四', 19, 1),
('王五', 17, 2),
('赵六', 20, 1);
```

#### 触发索引下推的 SQL 语句








```sql
-- 查询1班中年龄大于17岁的学生
SELECT * FROM student WHERE class_id = 1 AND age > 17;
```

#### 索引下推的工作原理

- **没有 ICP 时**：
  存储引擎通过`idx_class_age`索引找到所有`class_id=1`的记录（不管 age 是否满足），然后全部回表获取完整数据，再由 MySQL 服务器层过滤`age>17`的记录。
- **有 ICP 时**：
  存储引擎在遍历`idx_class_age`索引时，会同时判断`age>17`这个条件（因为`age`是联合索引的一部分），只将满足条件的记录回表，减少了回表次数。



**关键点**：只有索引中包含的字段（如上述`class_id`和`age`）才能被下推过滤，非索引字段的条件（如`name LIKE '张%'`）无法下推。

### 二、MySQL 索引覆盖（Covering Index）

索引覆盖指查询的所有字段（`SELECT`后的字段）都包含在某个索引中，此时 MySQL 无需回表，直接通过索引即可获取所有需要的数据，大幅提升查询效率。

#### 示例场景

使用上述`student`表及`idx_class_age (class_id, age)`联合索引。

#### 触发索引覆盖的 SQL 语句








```sql
-- 查询1班学生的年龄（只需要class_id和age，均在联合索引中）
SELECT class_id, age FROM student WHERE class_id = 1;
```

#### 索引覆盖的工作原理

- 该查询需要的字段`class_id`和`age`正好是联合索引`idx_class_age`的全部字段；
- MySQL 直接通过遍历索引`idx_class_age`即可获取所有`class_id=1`的记录的`age`值，无需访问主键索引回表；
- 执行计划中会显示`Using index`，表示使用了索引覆盖。

#### 另一个示例（非主键字段的覆盖索引）

如果创建索引`idx_name_age (name, age)`，则以下查询也会触发索引覆盖：










```sql
-- 查询名字为'张三'的学生的年龄（name和age都在索引中）
SELECT age FROM student WHERE name = '张三';
```








**关键点**：索引覆盖的核心是 “查询字段完全包含在索引中”，通常需要根据查询场景设计合适的联合索引（如将查询频繁的字段包含在索引中）。

### 总结

| 特性     | 核心作用                                   | 示例 SQL 特点                   | 执行计划标识            |
| -------- | ------------------------------------------ | ------------------------------- | ----------------------- |
| 索引下推 | 减少回表次数（存储引擎层过滤索引字段条件） | `WHERE`条件包含索引中的部分字段 | `Using index condition` |
| 索引覆盖 | 完全避免回表（查询字段都在索引中）         | `SELECT`和`WHERE`字段均在索引中 | `Using index`           |