Redis 主从复制和 Sentinel 是保证 Redis 高可用的核心机制，二者的工作原理及数据可靠性保证如下：

### 一、Redis 主从复制的大致过程

主从复制是 Redis 实现数据冗余和读写分离的基础，核心是**从节点（Slave）复制主节点（Master）的数据**，过程可分为三个阶段：

#### 1. 建立连接（握手阶段）

- 从节点通过 `slaveof <master-ip> <master-port>` 命令指定主节点，发起连接请求。
- 主节点接受连接后，双方建立 TCP 连接，从节点发送 `PING` 命令确认通信正常，主节点返回 `PONG` 响应。
- 从节点向主节点发送自身的 **运行 ID**（首次连接时为 `?`）和 **复制偏移量**（首次为 `-1`），主节点记录从节点信息。

#### 2. 全量复制（初始同步阶段）

- 若从节点是首次连接（或主从偏移量差距过大），主节点触发全量复制：
    - 主节点执行 `bgsave` 生成 RDB 快照，并将生成期间的写命令记录到 **复制缓冲区（replication buffer）**。
    - 主节点发送 RDB 快照给从节点，从节点接收后清空本地数据，加载 RDB 文件（覆盖原有数据）。
- 全量复制的目的是让从节点快速与主节点数据保持一致，适用于首次同步或从节点长时间离线后的重新同步。

#### 3. 增量复制（持续同步阶段）

- 从节点加载完 RDB 后，向主节点发送自己的复制偏移量，请求同步 RDB 生成期间的增量数据（即复制缓冲区中的命令）。
- 主节点将复制缓冲区中偏移量之后的命令发送给从节点，从节点执行这些命令，最终与主节点数据完全一致。
- 此后，主节点每执行一条写命令，都会将命令同步到复制缓冲区，并异步发送给所有从节点（从节点通过 `REPLCONF ACK` 定期汇报偏移量，主节点根据偏移量判断是否需要补发命令）。
