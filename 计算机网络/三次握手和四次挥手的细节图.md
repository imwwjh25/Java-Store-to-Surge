# 一、TCP 三次握手（建立连接）




```
客户端                                  服务端
CLOSED                                  LISTEN
  │                                       │
  │         SYN=1, seq=x                  │
  │─────────────────────────────────────>│
SYN_SENT                                 │
  │                                       │
  │      SYN=1, ACK=1, ack=x+1, seq=y     │
  │<─────────────────────────────────────│
                                        SYN_RCVD
  │                                       │
  │         ACK=1, ack=y+1, seq=x+1       │
  │─────────────────────────────────────>│
ESTABLISHED                            ESTABLISHED
                                           
                 连接建立成功
```

### 状态说明

- CLOSED：初始关闭状态
- LISTEN：服务端监听
- SYN_SENT：客户端已发 SYN，等待应答
- SYN_RCVD：服务端已收 SYN 并回复 SYN+ACK
- ESTABLISHED：连接建立

------

# 二、TCP 四次挥手（断开连接）




```
客户端                                  服务端
ESTABLISHED                            ESTABLISHED
  │                                       │
  │         FIN=1, seq=u                  │
  │─────────────────────────────────────>│
FIN_WAIT_1                               │
  │                                       │
  │         ACK=1, ack=u+1, seq=v         │
  │<─────────────────────────────────────│
FIN_WAIT_2                             CLOSE_WAIT
  │                                       │
  │         FIN=1, seq=w                  │
  │<─────────────────────────────────────│
                                       LAST_ACK
  │                                       │
  │         ACK=1, ack=w+1, seq=u+1       │
  │─────────────────────────────────────>│
TIME_WAIT                               CLOSED
(等待2MSL)
  │
CLOSED
```

### 状态说明

1. 客户端发 FIN → FIN_WAIT_1
2. 服务端回 ACK → 客户端 FIN_WAIT_2，服务端 CLOSE_WAIT
3. 服务端发 FIN → 服务端 LAST_ACK
4. 客户端回 ACK → TIME_WAIT（等 2MSL 确保对方收到 ACK）→ CLOSED