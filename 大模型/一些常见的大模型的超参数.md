### 一、核心生成控制参数



#### 1. **温度（Temperature）**



- **作用**：控制输出的随机性和创造性，取值范围通常为 **0~2**（部分模型支持更高值）。

- 原理

  ：基于模型输出的概率分布（每个 token 的预测概率），温度通过 “软化” 或 “硬化” 概率来调整选择倾向：

    - 温度→0：几乎只选择概率最高的 token（贪婪解码），输出极其确定、保守，甚至重复。
    - 温度→1：按原始概率分布随机选择，平衡确定性和多样性。
    - 温度 > 1：概率分布更平缓，低概率 token 被选中的可能性增加，输出更发散、有创造力，但可能出现逻辑混乱或不相关内容。

- 影响：

    - 适合精确任务（如代码生成、事实问答）：温度设为 **0.1~0.5**（减少错误）。
    - 适合创作任务（如写诗、故事）：温度设为 **0.7~1.2**（增加多样性）。

#### 2. **Top-P（核采样，Nucleus Sampling）**



- **作用**：控制生成时的候选 token 范围，取值范围为 **0~1**（通常 0.5~0.95）。

- **原理**：将模型预测的 token 按概率从高到低排序，累积概率直到达到 Top-P 阈值，只从这个 “核” 范围内选择下一个 token。例如 Top-P=0.9，表示只考虑累计概率达 90% 的前 N 个 token。

- 影响：

    - 与温度的区别：温度是调整概率分布的 “形状”，Top-P 是限制候选集的 “大小”。
    - Top-P 值越小（如 0.5）：候选集越小，输出越集中、确定，但可能缺乏变化。
    - Top-P 值越大（如 0.95）：候选集越大，保留更多低概率 token，输出更丰富，但可能引入噪声。

- **常用场景**：结合温度使用（如温度 0.7+Top-P 0.9），平衡多样性和稳定性。

#### 3. **Top-K**



- **作用**：强制限制每次生成时只从概率最高的前 K 个 token 中选择，K 为正整数（如 10、50、100）。

- **原理**：无论 token 概率如何，只保留 Top K 个候选，例如 K=5 时，只从概率前 5 的 token 中选。

- 影响：

    - K 越小（如 1）：等价于贪婪解码，输出完全确定，但可能单调。
    - K 越大（如 200）：候选越多，输出越多样，但计算量略有增加。

- **与 Top-P 的对比**：Top-K 是固定数量的候选，Top-P 是动态范围（概率累积），实际中常组合使用（如 Top-K=50+Top-P=0.9），避免极端情况。

### 二、输出长度控制参数



#### 1. **Max Tokens（最大 token 数）**



- **作用**：限制生成内容的总长度（输入 token + 输出 token ≤ Max Tokens），防止输出过长。

- 影响：

    - 设置过小：可能导致回答不完整（被截断），尤其复杂问题（如长文本总结、多步推理）。
    - 设置过大：浪费计算资源，甚至可能让模型 “跑题”（越长越容易发散）。

- **建议**：根据任务类型估算（如短句问答设 200~~500，长文生成设 1000~~2000），预留一定冗余。

#### 2. **Min Tokens（最小 token 数）**



- **作用**：强制模型生成至少指定数量的 token（部分模型支持），避免回答过短。
- **适用场景**：需要详细解释的任务（如 “详细说明 XX 原理”），防止模型用一两句话敷衍。

### 三、一致性与约束参数



#### 1. **频率惩罚（Frequency Penalty）**



- **作用**：降低重复生成相同 token（或 n-gram）的概率，取值范围 **-2~2**（通常 0~1）。

- **原理**：生成过的 token 会被施加惩罚（概率降低），惩罚力度随出现次数增加而增强。

- 影响：

    - 正数（如 0.5~1）：有效减少重复内容（如避免反复说同一句话、高频词滥用）。
    - 负数（如 - 1）：鼓励重复（极少用，除非特殊场景如诗歌押韵）。

#### 2. **存在惩罚（Presence Penalty）**



- **作用**：只要 token 出现过一次，就降低其再次出现的概率，取值范围 **-2~2**（通常 0~1）。
- **与频率惩罚的区别**：频率惩罚针对 “重复次数”（出现越多罚得越重），存在惩罚针对 “是否出现过”（出现过就罚，与次数无关）。
- **影响**：更严格地抑制重复，适合需要输出多样性的场景（如 brainstorming brainstorming），但过高可能导致逻辑断裂（避免必要的核心词重复）。

### 四、其他特殊参数



#### 1. **停止序列（Stop Sequences）**



- **作用**：指定一个或多个字符串，当模型生成到该序列时，立即停止输出。

- 场景：

    - 控制格式（如生成 JSON 时，用 “}” 作为停止符，确保结构完整）。
    - 避免冗余（如对话场景中，用 “用户：” 作为停止符，防止模型冒充用户说话）。

#### 2. **种子（Seed）**



- **作用**：固定随机数种子，使相同输入和参数下生成的结果完全一致（部分模型支持）。
- **用途**：调试（复现问题）、需要稳定输出的场景（如固定模板生成）。

#### 3. **响应格式（Response Format）**



- **作用**：强制模型按指定格式输出（如 JSON、Markdown、列表），部分模型（如 GPT-4）支持结构化指定。
- **影响**：减少格式错误，便于下游系统解析（如 API 对接、数据提取）。

### 超参数的组合策略



实际使用中，超参数需根据任务类型组合调整，例如：

- **事实性问答**：温度 0.2 + Top-P 0.8 + 频率惩罚 0.3（优先准确、避免重复）。
- **创意写作**：温度 0.9 + Top-P 0.95 + 存在惩罚 0.2（鼓励多样、减少重复）。
- **代码生成**：温度 0.1 + Top-K 10 + Max Tokens 1000（追求精确、完整）。

### 总结



超参数通过控制模型的 “随机性 - 确定性”“多样性 - 一致性”“长度 - 效率” 三大维度影响输出：

- 温度、Top-P、Top-K 决定创造性和发散性；
- 频率 / 存在惩罚 控制重复和冗余；
- Max Tokens、停止序列 约束输出长度和格式。

合理调整超参数的核心是：**让模型的 “行为模式” 匹配任务需求**—— 精确任务求 “稳”，创意任务求 “活”，结构化任务求 “准”。