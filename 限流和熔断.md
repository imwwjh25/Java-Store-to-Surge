### 一、核心区别：本质是 “主动防御” vs “被动止损”

|     特性     |                限流（Rate Limiting）                 |                 熔断（Circuit Breaking）                 |
| :----------: | :--------------------------------------------------: | :------------------------------------------------------: |
| **核心目标** |       **主动控制流量**，防止服务被过多请求压垮       |            **被动止损**，防止故障服务级联扩散            |
| **触发逻辑** | 基于**流量阈值**（如 QPS、并发数），提前拦截超量请求 |    基于**故障状态**（如错误率、超时率），自动切断链路    |
| **处理方式** |     直接**拒绝 / 排队**超量请求，或限制请求频率      | 当服务出现异常时，**快速切断**调用链路，避免持续消耗资源 |
| **核心价值** |           保护服务稳定性，保证核心功能可用           |              防止故障扩散，避免 “雪崩效应”               |
| **典型场景** |           秒杀活动、接口限流、热点接口保护           |          依赖服务超时 / 报错、服务间调用链故障           |

#### 1. 限流：“主动拦停”，从源头控制流量

限流的核心是 **“提前拦截”**，通过设定流量阈值（如每秒最多处理 1000 个请求），在请求到达服务前就进行过滤。

- **核心逻辑**：当请求量超过阈值时，直接返回 “系统繁忙”，或让请求排队等待。
- **目的**：**保护服务不被压垮**，即使上游请求再多，服务也能保持稳定运行。
- **举例**：电商平台的 “秒杀接口”，通过限流限制每秒请求数，避免服务器因流量过载宕机。

#### 2. 熔断：“被动止损”，从链路切断故障

熔断的核心是 **“故障止损”**，基于服务的**错误率 **（如 1 分钟内错误率超过 50%），自动切断对故障服务的调用。

- **核心逻辑**：当服务出现持续故障时，快速切断调用链路，避免持续的资源消耗（如线程池耗尽），同时给服务 “喘息” 时间。
- **目的**：**防止故障扩散**，避免一个服务的故障导致整个微服务链崩溃（即 “雪崩效应”）。
- **举例**：支付服务调用订单服务时，若订单服务超时率过高，熔断机制会快速切断调用，避免支付服务因等待订单服务而耗尽资源。

### 二、作用位置：服务端 vs 客户端

#### 1. 限流：主要作用在**服务端**

- **原因**：限流的核心是 “控制服务的处理能力”，需要在服务的**入口处**（如网关、接口层）进行流量拦截。

- 典型位置：

  - 网关层（如 Spring Cloud Gateway、Nginx）：通过配置限流规则（如令牌桶、漏桶算法）限制请求进入服务。
  - 服务内部（如接口方法）：通过注解（如`@RateLimiter`）限制单个接口的 QPS。

  

- **举例**：在服务的 Controller 层添加`@RateLimiter`注解，限制该接口每秒最多处理 100 个请求。

#### 2. 熔断：主要作用在**客户端**

- **原因**：熔断的核心是 “控制对下游服务的调用”，需要在**调用方**（客户端）记录调用状态，当出现故障时触发熔断。

- 典型位置：

  - 客户端调用层（如 Feign、Dubbo）：通过熔断器组件（如 Resilience4j、Sentinel）监控调用状态，当错误率超过阈值时触发熔断。
  - 服务间调用链路：客户端调用服务时，若多次超时 / 报错，熔断机制会自动切断调用。

  

- **举例**：在 Feign 调用中集成 Sentinel，当调用订单服务的错误率超过 50% 时，熔断机制会快速切断调用，避免支付服务被拖垮。

### 三、典型场景：如何选择使用？

#### 1. 限流适用场景

- 服务的**处理能力有限**，无法支撑突发流量（如秒杀、促销活动）。
- 服务的**核心功能**（如支付、下单）需要优先保证稳定性，避免被非核心请求压垮。
- 服务的**资源有限**（如线程池、内存），无法处理过多并发请求。

#### 2. 熔断适用场景

- 服务的**下游依赖**（如数据库、缓存、第三方接口）出现故障（如超时、宕机）。
- 服务的**调用链过长**，一个服务的故障可能导致整个链崩溃（如 “雪崩效应”）。
- 服务的**响应时间过长**，持续消耗资源（如线程池耗尽）。

### 四、总结

- **核心区别**：限流是 “主动控制流量”，从源头保护服务；熔断是 “被动止损”，防止故障扩散。
- **作用位置**：限流主要作用在**服务端**（入口拦截）；熔断主要作用在**客户端**（调用方监控）。
- **实际应用**：通常会**组合使用**—— 比如在网关层用限流控制整体流量，在客户端用熔断防止故障扩散，共同保障微服务的稳定性。
